# Non regression tests 

function(yabmp_add_test file)
	set(CONVERT_FAILS FALSE)
	set(INFO_FAILS FALSE)
	
	if (${ARGC} GREATER 1)
		set(CONVERT_FAILS ${ARGV1})
		if (${ARGC} GREATER 2)
			set(INFO_FAILS ${ARGV2})
		endif()
	endif()
	
	set(INPUT ${CMAKE_CURRENT_SOURCE_DIR}/input/${file})
	get_filename_component(OUTPUTDIR ${CMAKE_CURRENT_BINARY_DIR}/${file} DIRECTORY)
	if (NOT EXISTS "${OUTPUTDIR}")
		file(MAKE_DIRECTORY "${OUTPUTDIR}")
	endif()
	
	add_test(NAME ${file}-info COMMAND yabmpinfo -o "${CMAKE_CURRENT_BINARY_DIR}/${file}.info.txt" "${INPUT}" )
	if (INFO_FAILS)
		set_tests_properties(${file}-info PROPERTIES WILL_FAIL)
	else()
		add_test(NAME ${file}-info-compare COMMAND "${CMAKE_COMMAND}" -E compare_files "${CMAKE_CURRENT_SOURCE_DIR}/expected/${file}.info.txt" "${CMAKE_CURRENT_BINARY_DIR}/${file}.info.txt")
		set_tests_properties(${file}-info-compare PROPERTIES DEPENDS ${file}-info)
	endif()
endfunction()


# bmpsuite good tests
yabmp_add_test("bmpsuite/g/pal1.bmp")
yabmp_add_test("bmpsuite/g/pal1bg.bmp")
yabmp_add_test("bmpsuite/g/pal1wb.bmp")
yabmp_add_test("bmpsuite/g/pal4.bmp")
yabmp_add_test("bmpsuite/g/pal4rle.bmp")
yabmp_add_test("bmpsuite/g/pal8-0.bmp")
yabmp_add_test("bmpsuite/g/pal8.bmp")
yabmp_add_test("bmpsuite/g/pal8nonsquare.bmp")
yabmp_add_test("bmpsuite/g/pal8os2.bmp")
yabmp_add_test("bmpsuite/g/pal8rle.bmp")
yabmp_add_test("bmpsuite/g/pal8topdown.bmp")
yabmp_add_test("bmpsuite/g/pal8v4.bmp")
yabmp_add_test("bmpsuite/g/pal8v5.bmp")
yabmp_add_test("bmpsuite/g/pal8w124.bmp")
yabmp_add_test("bmpsuite/g/pal8w125.bmp")
yabmp_add_test("bmpsuite/g/pal8w126.bmp")
yabmp_add_test("bmpsuite/g/rgb16-565.bmp")
yabmp_add_test("bmpsuite/g/rgb16-565pal.bmp")
yabmp_add_test("bmpsuite/g/rgb16.bmp")
yabmp_add_test("bmpsuite/g/rgb24.bmp")
yabmp_add_test("bmpsuite/g/rgb24pal.bmp")
yabmp_add_test("bmpsuite/g/rgb32.bmp")
yabmp_add_test("bmpsuite/g/rgb32bf.bmp")
